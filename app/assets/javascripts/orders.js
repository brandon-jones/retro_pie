var delay, changeSort, showOrderDetails, fadeOutGreen, getPrice, getQuantity, isRowActive, remove_updated_classes, saveOrderEdits, updateQuantity, toggleChangedFlag;

$(function() {
  updateFinalTotal();
  $(".price-changer").on("change", updateFinalTotal);
  $('.order-change').on("change", toggleChangedFlag);
  $('#save_order_edits').on("click", saveOrderEdits);
  $('.change_sort').on("click", changeSort);
  return $('.order-details').on("click", showOrderDetails);
});

showOrderDetails = function(e) {
  var details_id;
  e.stopPropagation();
  e.preventDefault();
  details_id = "#" + this.getAttribute('data');
  if ($(details_id)[0].style.display === 'none') {
    return $(details_id).show(200, 'linear');
  } else {
    return $(details_id).hide(200, 'linear');
  }
};

changeSort = function(event) {
  event.stopPropagation();
  event.preventDefault();
  $('#save_order_edits').addClass('hidden');
  return $.get('/orders', {
    sort_by: this.getAttribute('data'),
    sort_order: $('#sort_order').val(),
    table_only: true
  }, function(data) {
    $('#order_table').html(data);
    $('.change_sort').on("click", changeSort);
    $('.order-details').on("click", showOrderDetails);
    return $('.order-change').on("change", toggleChangedFlag);
  });
};

updateFinalTotal = function(event) {
  var total_price;
  total_price = 25;
  $(".item-row").each(function(element) {
    var price, quantity;
    if (isRowActive(this)) {
      quantity = getQuantity(this);
      price = getPrice(this, quantity);
      total_price = parseInt(total_price) + parseInt(price);
    }
  });
  return $('.total').text("$" + total_price);
};

getPrice = function(row, quantity) {
  if (row.children[3].innerText === "included") {
    if (quantity > 1) {
      return row.children[3].children[0].value;
    } else {
      return 0;
    }
  } else {
    return quantity * row.children[3].children[0].value;
  }
};

getQuantity = function(row) {
  return row.children[4].children[0].value;
};

isRowActive = function(row) {
  if (row.children[0].children[0].checked === true) {
    return true;
  } else {
    return false;
  }
};

toggleChangedFlag = function() {
  $('#order-index').addClass('unsaved-changes');
  $(this).addClass('unsaved-changes-background');
  if ($('#save_order_edits').hasClass('hidden')) {
    return $('#save_order_edits').removeClass('hidden');
  }
};

saveOrderEdits = function() {
  var changedRows;
  changedRows = [];
  $('.unsaved-changes-background').each(function(element) {
    var parentElement;
    $(this).removeClass('unsaved-changes-background');
    $(this).closest(".order-row").addClass('flash-save');
    delay(1, fadeOutGreen);
    parentElement = this.parentElement.parentElement;
    return changedRows.push([parentElement.getElementsByClassName('order_id')[0].innerHTML, parentElement.getElementsByClassName('status_id')[0].value]);
  });
  $('#save_order_edits').addClass('hidden');
  $('#order-index').removeClass('unsaved-changes');
  if (changedRows.length > 0) {
    return $.post('/orders/update', {
      changed_orders: changedRows.toString()
    }, function(data) {});
  }
};

fadeOutGreen = function() {
  return $('.flash-save').each(function(element) {
    $(this).removeClass('flash-save');
    $(this).addClass('fade-out');
    return delay(5000, remove_updated_classes);
  });
};

remove_updated_classes = function() {
  console.log('remove_updated_classes');
  return $('.fade-out').each(function(element) {
    return $(this).removeClass('fade-out');
  });
};

delay = function(ms, func) {
  return setTimeout(func, ms);
};

stripDollarSign = function(str) {
  return str.replace(/\$/g,'');
}

// ---
// generated by coffee-script 1.9.0
